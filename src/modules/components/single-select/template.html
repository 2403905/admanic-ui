<!-- search input -->
<div class="adm-select__input" [formGroup]="form">
    <textarea
            spellcheck="false"
            rows="1"
            [readonly]="disableSearch || isPendingRequest"
            [tabindex]="disabled ? -1 : 0"
            [placeholder]="placeholder"
            (click)="inputClickHandler($event)"
            (keyup)="inputKeyUpHandler($event)"
            (keydown.enter)="enterKeydownHandler($event)"
            (focus)="showResults($event)"
            (blur)="inputBlurHandler($event)"
            formControlName="search"></textarea>

    <!-- toggle button -->
    <button class="adm-select__caret" tabindex="-1" type="button" (click)="toggleResults($event)">
        toggle
        <div class="adm-spinner-container" *ngIf="!isDataLoaded">
            <div class="spinner spinner-1"></div>
            <div class="spinner spinner-2"></div>
            <div class="spinner spinner-3"></div>
            <div class="spinner spinner-4"></div>
            <div class="spinner spinner-5"></div>
            <div class="spinner spinner-6"></div>
            <div class="spinner spinner-7"></div>
            <div class="spinner spinner-8"></div>
            <div class="spinner spinner-9"></div>
            <div class="spinner spinner-10"></div>
            <div class="spinner spinner-11"></div>
            <div class="spinner spinner-12"></div>
        </div>
    </button>
    <!-- / toggle button -->

    <!-- view link -->
    <ng-template [ngIf]="_viewPath && value">
        <div class="adm-select__view-item">
            <a class="adm-select__view-item__btn" target="_blank" href="{{_viewPath}}/{{value}}">
                View <i class="material-icons">launch</i>
            </a>
        </div>
    </ng-template>
    <!-- /view link -->
</div>
<!-- / search input -->

<!-- options list wrapper -->
<div class="adm-select__options" *ngIf="isResultsShown" (click)="resultsClickHandler($event)">
    <!-- lists results -->
    <ul class="adm-select__options__list">
        <!-- template for list without groups -->
        <ng-template [ngIf]="!isWithGroups">
            <li *ngFor="let item of _options; let i = index; trackBy: trackListByFn;"
                (mouseover)="focusedResultIndex = i;"
                [ngClass]="{'hidden':item.hidden, 'is-selected':item.value === this.value && item.value !== null, 'focused':focusedResultIndex === i}"
                (click)="selectItemHandler(item.value, i)">{{item.label}}
            </li>
        </ng-template>
        <!-- / template for list without groups -->


        <!-- template for list with groups -->
        <ng-template [ngIf]="isWithGroups">
            <ng-template ngFor let-group [ngForOf]="_options" let-i="index">
                <p [ngClass]="{'hidden':group.hidden}">{{group.name}}</p>
                <li *ngFor="let item of group?.values; trackBy: trackListByFn;"
                    [ngClass]="{'hidden':item.hidden, 'is-selected':item.selected}"
                    (click)="selectItemHandler(item.value)">{{item.label}}
                </li>
            </ng-template>
        </ng-template>
        <!-- / template for list with groups -->

        <!-- results el -->
        <li *ngIf="(!allowCreateEntity && isOptionsNotFound) || (allowCreateEntity && isOptionsNotFound && !searchModel.value)">
            {{isPendingRequest ? 'Searching...' : !!serverError ? 'The results could not be loaded.' : 'No results found'}}
        </li>

        <!-- add new entity btn -->
        <li *ngIf="allowCreateEntity && isOptionsNotFound && searchModel?.value?.length>0"
            (click)="addNewEntityToOptions($event);">
            {{searchModel.value}} <b>{{newItemPostfix}}</b>
        </li>
        <!-- / add new entity btn -->

    </ul>
    <!-- / lists results -->

    <!-- clear selection btn -->
    <ul *ngIf="allowClear && options.length && !isOptionsNotFound && value"
        class="adm-select__options__list clear-selection">
        <li (click)="clearSelection($event)">None</li>
    </ul>
    <!-- / clear selection btn -->

    <!-- load more button -->
    <button *ngIf="totalItemsInAjaxResponse > _options.length && !isOptionsNotFound && !isPendingRequest"
            class="adm-select__add-new-btn"
            (click)="loadMoreOptionsFromServer($event);"
            type="button">
        <i class="material-icons">cached</i> Load more items
        <small>({{_options.length}} from {{totalItemsInAjaxResponse}}
            shown)
        </small>
    </button>
    <!-- /load more button -->

    <!-- add new btn -->
    <button *ngIf="showAddNewBtn" class="adm-select__add-new-btn" type="button"
            (click)="onAddClicked.emit($event); isResultsShown = false;">
        <i class="material-icons">add</i> Add new
    </button>
    <!-- / add new btn -->
</div>
<!-- / options list wrapper -->

<!-- validators -->
<adm-validator-messages *ngIf="allowCreateEntity" [field]="searchModel"></adm-validator-messages>
<!-- / validators -->

